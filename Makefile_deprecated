CPP_SRC := $(wildcard src/*.cpp)
CPP_SRC += $(wildcard src/system/*.cpp)
C_SRC := $(wildcard src/*.c)
C_SRC += $(wildcard src/system/*.c)

OBJDIR=./obj/
OBJ := $(CPP_SRC:.cpp=.o)
OBJ += $(C_SRC:.c=.o)
OBJS = $(addprefix $(OBJDIR), $(OBJ))

all:BUILD_DIR $(OBJS) 
	g++ $(OBJS) -shared -L/usr/local/cuda/lib64 -L/usr/lib/x86_64-linux-gnu -lnvidia-ml -o $(OBJDIR)libgpu_partition.so

$(OBJDIR)%.o:%.c
	gcc -I/usr/local/cuda/include -fPIC -c $^ -o $@

$(OBJDIR)%.o:%.cpp
	g++ -I/usr/local/cuda/include -std=c++11 -fPIC -c $^ -o $@

BUILD_DIR:
	mkdir -p $(OBJDIR)src/system

